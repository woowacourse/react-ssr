# β΅ SSR λ λ”λ§ λ―Έμ…

## π‘€ λ¦¬λ·°λ¥Ό ν†µν• μƒκ° λ‚λ”

### SSR λ λ”λ§ μ‹ μ΄κΈ° λ λ”λ§ μ„±λ¥μ΄ μ™ μ λ¦¬ν• κΉ?

SSRμ€ μ„λ²„μ—μ„ HTMLμ„ λ―Έλ¦¬ μƒμ„±ν•΄ ν΄λΌμ΄μ–ΈνΈμ— μ „λ‹¬ν•κΈ° λ•λ¬Έμ—, ν΄λΌμ΄μ–ΈνΈλ” μ¶”κ°€μ μΈ μ”μ²­μ΄λ‚ λ λ”λ§ κ³Όμ • μ—†μ΄ **μ¦‰μ‹ HTMLμ„ λ λ”λ§ν•  μ μμµλ‹λ‹¤**. λ”°λΌμ„ μ΄κΈ° λ΅λ”© μ†λ„κ°€ λΉ¨λΌμ§€κ³ , μ‚¬μ©μλ” λΉ λ¥΄κ² νμ΄μ§€μ κΈ°λ³Έ μ½ν…μΈ λ¥Ό ν™•μΈν•  μ μκ² λ©λ‹λ‹¤.

### μ„λ²„μ—μ„ λ λ”λ§ν• μν™” λ©λ΅μ„ μ–΄λ–»κ² ν΄λΌμ΄μ–ΈνΈμ— λ°μ΄ν„°λ¥Ό μ „λ‹¬ν•κ³  λΈλΌμ°μ €μ—μ„λ” μ–΄λ–¤ μ‘μ—…μ„ μν–‰ν• κΉ?

1. μ„λ²„μ—μ„ λ°μ΄ν„° fetch λ° λ λ”λ§
   - **μ„λ²„μ—μ„ λ°μ΄ν„° fetch**: μ„λ²„λ” μν™” λ°μ΄ν„°λ¥Ό TMDB μ„λ²„μ—μ„ κ°€μ Έμµλ‹λ‹¤.
   - **Reactλ¥Ό μ‚¬μ©ν•΄ λ λ”λ§**: κ°€μ Έμ¨ λ°μ΄ν„°λ¥Ό App νΉμ€ κ° μ»΄ν¬λ„νΈμ— μ „λ‹¬ν•κ³ , `react/client`μ—μ„ μ κ³µν•λ” `renderToString`μ„ μ‚¬μ©ν•΄ λ°μ΄ν„°λ¥Ό ν¬ν•¨ν• React μ»΄ν¬λ„νΈλ¥Ό HTMLλ΅ λ λ”λ§ν•©λ‹λ‹¤.
   - **HTMLμ— λ°μ΄ν„° ν¬ν•¨**: λ λ”λ§λ HTMLμ— \<script\> νƒκ·Έλ¥Ό μ‚¬μ©ν•΄ μ „μ—­ λ³€μλ΅ μ‚½μ…ν•©λ‹λ‹¤.
2. ν΄λΌμ΄μ–ΈνΈμ—μ„ Hydration μν–‰
   - **μ„λ²„ HTMLκ³Ό React μ»΄ν¬λ„νΈ μ—°κ²°**: ν΄λΌμ΄μ–ΈνΈ μΈ΅ Reactκ°€ λ΅λ“λ ν›„, `hydrateRoot` ν•¨μλ¥Ό μ‚¬μ©ν•΄ μ„λ²„μ—μ„ μ „λ‹¬λ HTMLκ³Ό React μ»΄ν¬λ„νΈλ¥Ό μ—°κ²°ν•©λ‹λ‹¤.
   - **μ„λ²„μ—μ„ μ „λ‹¬λ λ°μ΄ν„°λ¥Ό μƒνƒλ΅ μ„¤μ •**: μ„λ²„μ—μ„ \<script\>λ¥Ό μ‚¬μ©ν•΄ `window.\_\_INITIAL_DATA\_\_`μ— λ„£μ€ μν™” λ°μ΄ν„°λ¥Ό μ½μ–΄μ™€ ν΄λΌμ΄μ–ΈνΈμ μƒνƒλ΅ μ„¤μ •ν•©λ‹λ‹¤.
   - **μ„λ²„ HTMLκ³Ό React λ™κΈ°ν™”**: ν΄λΌμ΄μ–ΈνΈλ” hydrateRootλ¥Ό μ‚¬μ©ν•μ—¬ μ΄κΈ° μƒνƒμ™€ HTMLμ„ λ™κΈ°ν™”ν•κ³ , μ΄λ²¤νΈ ν•Έλ“¤λ¬λ¥Ό λ³µμ›ν•μ—¬ μ „μ²΄ React μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν™μ„±ν™”ν•©λ‹λ‹¤.

### μ „μ—­ κ°μ²΄ μ΄κΈ°ν™” μ‘μ—…μ€ μ™ μ§„ν–‰ν•΄μ•Ό ν• κΉ?

μ „μ—­ κ°μ²΄ μ΄κΈ°ν™” μ‘μ—…μ„ μν–‰ν•μ§€ μ•μΌλ©΄ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ μ΄κΈ° λ°μ΄ν„°κ°€ μΌμΉν•μ§€ μ•μ„ μ μμµλ‹λ‹¤. μ΄λ” Hydration κ³Όμ •μ—μ„ μ¤λ¥λ¥Ό μ λ°ν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, λ‹¤μκ³Ό κ°™μ€ μ¤λ¥κ°€ λ°μƒν•  μ μμµλ‹λ‹¤

```shell
react-dom.development.js:86 Warning: An error occurred during hydration. The server HTML was replaced with client content in
react-dom.development.js:12507 Uncaught Error: Hydration failed because the initial UI does not match what was rendered on the server.
```

μ΄ μ¤λ¥λ” μ„λ²„μ—μ„ λ λ”λ§λ HTMLκ³Ό ν΄λΌμ΄μ–ΈνΈμ—μ„ μν™”λλ” React μ»΄ν¬λ„νΈμ μ΄κΈ° μƒνƒκ°€ μΌμΉν•μ§€ μ•κΈ° λ•λ¬Έμ— λ°μƒν•©λ‹λ‹¤.

μλ¥Ό λ“¤μ–΄ μ„λ²„μ—μ„ λ°μ΄ν„°λ¥Ό κ°€μ Έμ™€ HTMLμ„ λ λ”λ§ν–λ”λ°, ν΄λΌμ΄μ–ΈνΈμ—μ„ ν•΄λ‹Ή λ°μ΄ν„°λ¥Ό μ „μ—­ λ³€μλ΅ μ΄κΈ°ν™”ν•μ§€ μ•μΌλ©΄ ν΄λΌμ΄μ–ΈνΈλ” λ°μ΄ν„°λ¥Ό μ•μ§€ λ»ν•΄ λ‹¤λ¥Έ λ‚΄μ©μΌλ΅ λ λ”λ§ν•κ² λ©λ‹λ‹¤.
μ΄λ ‡κ² λλ©΄ ν΄λΌμ΄μ–ΈνΈλ” κΈ°μ΅΄ DOMμ„ μ¬μ΅°μ •ν•κ² λ©λ‹λ‹¤. μ΄λ΅ μΈν•΄ DOM μ”μ†λ“¤μ΄ ν™”λ©΄μ— κ·Έλ ¤μ΅λ‹¤κ°€ μ‚¬λΌμ§€λ” λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

![](./hydration-error.gif)

λ”°λΌμ„ μ „μ—­ κ°μ²΄(μ: window.\_\_INITIAL_DATA\_\_)λ¥Ό μ΄κΈ°ν™”ν•μ—¬ μ„λ²„μ™€ λ™μΌν• λ°μ΄ν„°λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‚¬μ©ν•λ„λ΅ μ„¤μ •ν•λ©΄, Hydration κ³Όμ •μ—μ„ λ°μ΄ν„° λ¶μΌμΉλ¥Ό λ°©μ§€ν•  μ μμµλ‹λ‹¤.
